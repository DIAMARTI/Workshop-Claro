<h1>Operaciones avanzadas con Ansible Tower</h1>
<p>
<strong>Meta:</strong>
<br>- Entender los proceso avanzados con Ansible tower, como la integracion con GIT, formularios, worksflows, etc.
</p>
<p>
<strong>Objetivos:</strong>
<br>- Realizar operaciones avanzadas con Red Hat Ansible Tower(Demostración)
</p>
<p>
<strong>Secciones:</strong>
<br>-  .(Teórico - Practico)
<br>- GIT y worksflows.(Teórico)
<br>- Instalación de Red Hat Ansible. (Demostración)
</p>
<p>
<strong>Laboratorios:</strong>
<br>- Operaciones avanzadas con Ansible Tower 
</p>

# Integracion con GIT
**Creando un usuario en GIT**
Para completar el capitulo, los alumnos tendran a su disposicion un servidor de GOGS en la direccion url http://192.168.10.190:3000 o http://classroom.opennova.pe:3000. Para crear un nuevo usuario podra ingresar a la pagina y hacer click sobre el boton de registro
<p align="left"><img src="https://github.com/workshopopennova/workshopclaropr/blob/main/images/ansible/ansible029.png?raw=true"></p>

Ingresara los datos de su registro
<p align="left"><img src="https://github.com/workshopopennova/workshopclaropr/blob/main/images/ansible/ansible030.png?raw=true"></p>

Con el registro listo podra iniciar sesion en la plataforma
<p align="left"><img src="https://github.com/workshopopennova/workshopclaropr/blob/main/images/ansible/ansible031.png?raw=true"></p>

Podra crear un nuevo repositorio con el boton +
<p align="left"><img src="https://github.com/workshopopennova/workshopclaropr/blob/main/images/ansible/ansible032.png?raw=true"></p>


Nombramos el repositorio, para completar los laboratorios dejamos el repositorio como publico
<p align="left"><img src="https://github.com/workshopopennova/workshopclaropr/blob/main/images/ansible/ansible033.png?raw=true"></p>

Con el repositorio creado, copiamos el url del repositorio para administrarlo via comandos en los siguientes pasos
<p align="left"><img src="https://github.com/workshopopennova/workshopclaropr/blob/main/images/ansible/ansible034.png?raw=true"></p>





```
[root@server08 ~]# ping -c1 localhost
```
```
[root@server08 ~]# ping -c1 $(hostname -f)
```
```
[root@server08 ~]# ping -c1 $(hostname -s)
```
```
[root@server08 ~]# nslookup server08.opennova.pe
Server:         192.168.10.178
Address:        192.168.10.120#53

Name:   server08.opennova.pe
Address: 192.168.10.178
```
```
[root@server08 ~]# nslookup 192.168.10.178
178.10.168.192.in-addr.arpa      name = server08.opennova.pe
```

Es buena idea indicar el el archivo /etc/hosts
<br>**\<IP\> \<FQDN Ansiblee\> \<Short name Ansible\>**
```
192.168.10.178 server08.opennova.pe server08
```
**Habilitación de conexiones de un cliente a un servidor satélite**
```
[root@server08 ~]# firewall-cmd \
--add-port="80/tcp" --add-port="443/tcp" \
--add-port="22/tcp" --add-port="5432/tcp"
```
```
[root@server08 ~]# firewall-cmd --runtime-to-permanent
```
```
[root@server08 ~]# firewall-cmd --list-all
```
<br>**Instalacion**

El sistema ya cuenta con un registro a Red Hat Stellite, por lo tanto solo debemos validar los reposotorios y registrar el repositorio de ansible
```
[root@server08 ~]# subscription-manager repos --list
[root@server08 ~]# subscription-manager repos --enable=ansible-2.9-for-rhel-8-x86_64-rpms
```
**Borrar metadata yum**
```
[root@server08 ~]# yum clean all
```
**Verificar repositorios configurados**
``` 
[root@server08 ~]# yum repolist enabled
```

Validamos que el sistema tenga al menos los siguientes repositorios

ansible-2.9-for-rhel-8-x86_64-rpms

rhel-8-for-x86_64-appstream-rpms

rhel-8-for-x86_64-baseos-rpms


**Realizar una lista de paquetes necesarios para la administración de la maquina virtual.**

```
[root@server08 ~]# yum install ansible git wget
```


**Actualizar el sistema en conjunto y reiniciar**

```
[root@server08 ~]# yum update
```

```
[root@server08 ~]# reboot
```

**Instalar Red Hat Ansible Tower**

Descargamos desde el ftp del salon el instalador de Ansible Tower y descomprimirlo

<br>`[root@server08 ~]# wget ftp://classroom.opennova.pe/ansible-automation-platform-setup-bundle-1.2.5-1.tar.gz`
<br>`[root@server08 ~]# tar -xzvf ansible-automation-platform-setup-bundle-1.2.5-1.tar.gz`
<br>`[root@server08 ~]# cd ansible-automation-platform-setup-bundle-1.2.5-1`

Modificar el archivo inventory para que pueda customizar las claves de admin y de awx a redhat

<br>`[root@server08 ~]# vi inventory`
<br>`admin_password='redhat'`
<br>`pg_password='redhat''`
`

Ejecutar el instalador con

<br>`[root@server08 ~]# ./setup.sh`

**Nota: Para evitar problemas de perdida de conectividad hacia la terminar virtual se recomienda ejecutar elprocedimiento de instalación por screen**
<br>**Instalar screen**
```
[root@satellite ~]# yum install ftp://classroom.opennova.pe/screen-4.6.2-12.el8.x86_64.rpm
```
**Generar un alias de conexión screen**
```
[root@satellite ~]# screen -S andy
```
**Listar conexión screen, identificar el id ejemplo: 3081**
```
[root@satellite ~]# screen -ls
There is a screen on:
        3081.andy      (Attached)
1 Socket in /var/run/screen/S-root.
```
**En caso de des-conexión abrir otro terminal y ejecutar el comando indicado para restablecer la conexión, recordar poner el id que se genere en su terminal**
```
[root@server08 ~]# screen -r 3081.andy
```


**Abrir puertos de firewall**

Abrir los puertos del firewall correspondiente al acceso HTTP, HTTPS y SSH, opcionalmente el puerto 5432 es necesario solo si se trabaja con bases de datos externas

```
[root@server08 ~]# firewall-cmd \
--add-port="80/tcp" --add-port="443/tcp" \
--add-port="22/tcp" --add-port="5432/tcp"
[root@server08~]# firewall-cmd --runtime-to-permanent
[root@server08 ~]# firewall-cmd --list-all
```

En este punto indicar a su instructor que active la plataforma de Ansible Tower con una suscripcion de prueba, luego ingresar con un navegador web para validar su instalacion
<p align="left"><img src="https://github.com/workshopopennova/workshopclaropr/blob/main/images/ansible/ansible001.png?raw=true"></p>


