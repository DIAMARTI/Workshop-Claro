<h1>OpenShift Dia 3</h1>

<p>
<strong>Meta:</strong>
<br>Conocer el flujo de trabajo de openshift
</p>
<p>
<strong>Objetivos:</strong>
<br>- Automatizar el despliegue de aplicaciones con openshift
</p>
<p>
<strong>Secciones:</strong>
<br>- Gestión aplicaciones
</p>
<p>
<strong>Laboratorios:</strong>
<br><strong>- Desplegar un servicio web con contenido externo</strong>


</p>

<strong>Requisitos:</strong>
<br><strong>- Satellite</strong>
<br><strong>- RHEL client</strong>

<h3><br><strong>## Despliegue de webserver con contenido desde un git</strong></h3>
Antes de desplegar el servidor web desde el cliente de openshift, ingresamos al git privado de la clase disponible en http://192.168.10.190:3000 y creamos una cuenta de alumno0X
<p align="left"><img src="https://github.com/workshopopennova/workshopclaro/raw/main/images/os001.png?raw=true?raw=true"></p>

Ingresamos los datos del usuario0X
<p align="left"><img src="https://github.com/workshopopennova/workshopclaro/raw/main/images/os002.png?raw=true?raw=true"></p>

Iniciamos sesion con el usuario creado
<p align="left"><img src="https://github.com/workshopopennova/workshopclaro/raw/main/images/os003.png?raw=true?raw=true"></p>

Creamos un nuevo repositorio
<p align="left"><img src="https://github.com/workshopopennova/workshopclaro/raw/main/images/os004.png?raw=true?raw=true"></p>

Nombremos este repositorio website y que no sea privado
<p align="left"><img src="https://github.com/workshopopennova/workshopclaro/raw/main/images/os005.png?raw=true?raw=true"></p>

Con el repositorio creado pero sin archivos ingresamos a nuestro estacion linux e iniciamos sesion con el usuario alumno0X
<br>`# oc login -u alumno08`

Cambiamos al proyecto website0X
<br>`# oc project website08`

Descargamos el contenido del repositorio website desde el ftp del salon
<br>`# wget ftp://192.168.10.190/openshift/website.tar.gz`

Descomprimimos e ingresamos al contenido
<br>`# tar -xzvf website.tar.gz`
<br>`# cd website/`

Procedemos a poblar el repositorio del gIt con nuestros archivos descargados
<br>`# touch README.md`
<br>`# git init`
<br>`# git add *`
<br>`# git commit -m "first commit"`
<br>`# git remote add origin http://192.168.10.190:3000/alumno08/website.git`
<br>`# git push -u origin master`

Regresamos a la pagina del git y validamos la creacion del contenido web
<p align="left"><img src="https://github.com/workshopopennova/workshopclaro/raw/main/images/os006.png?raw=true?raw=true"></p>

En el terminal logueado, descargamos desde el ftp del salon una imagen de podman de php
<br>`# cd`
<br>`# wget ftp://192.168.10.190/openshift/php-70-rhel7.tar`

Cargamos esta imagen en el podman local
<br>`# podman load -i php-70-rhel7.tar`

Verificamos la disponibilidad de la imagen
<br>`# podman image list`

Importamos esta imagen a nuestro proyecto website
<br>`# oc import-image registry.access.redhat.com/rhscl/php-70-rhel7 --confirm`
<br>`# oc get is`

Desplegamos esta imagen en un app llamado website y que su contruccion referencie a nuestro git con el contenido propio
<br>`# oc new-app php-70-rhel7~http://192.168.10.190:3000/alumno08/website.git --name=website`

Verificamos el despliegue de la aplicacion
<br>`# oc logs -f buildconfig/website`

Publicamos la aplicacion
<br>`# oc expose service/website`

Verificamos la ruta de publicacion para verificarla por navegador web
<br>`# oc get routes`

<p align="left"><img src="https://github.com/workshopopennova/workshopclaro/raw/main/images/os007.png?raw=true?raw=true"></p>









Desde la linea de comandos descargamos los requisitos para registrar el sistema cliente
<br>`# curl --insecure --output katello-ca-consumer-latest.noarch.rpm https://satellite.opennova.pe/pub/katello-ca-consumer-latest.noarch.rpm`
<br>`# yum localinstall katello-ca-consumer-latest.noarch.rpm`

Registramos el sistema usando el Activation Key `rhel8` que ya fue creador por el administrador
<br>`# subscription-manager register --org="OpenNova" --activationkey="rhel8"`
<br>`# subscription-manager attach --auto`

Debera validar que tenga al menos 3 repostorios: Base, AppStream y Tools de Satellite con el comando
<br>`# yum repolist`

En caso de no tener los repositorios activados, hacerlo manualmente con:
<br>`# subscription-manager repos --enable=rhel-8-for-x86_64-appstream-rpms`
<br>`# subscription-manager repos --enable=rhel-8-for-x86_64-baseos-rpms`
<br>`# subscription-manager repos --enable=satellite-tools-6.7-for-rhel-8-x86_64-rpms`

Instalamos los agentes de katello
<br>`# yum -y install katello-host-tools`
<br>`# yum -y install katello-host-tools-tracer`
<br>`# yum -y install katello-agent`

<h3><br><strong>## Instalar un paquete vía Satellite</strong></h3>

La plataforma de satellite permite instalar un paquete a los clientes registrados, intentemos instalar el paquete CHRONY al cliente satellite, antes de iniciar la instalación ingrese al terminal del cliente satellite y valide que no tenga el rpm de chrony instalado

<br>`# rpm -q chrony`
<br>`package chrony is not installed`

Ingresamos al cliente en la sección de Hosts > Hosts de contenido y seleccionamos el cliente
<p align="left"><img src="https://github.com/workshopopennova/tecnologiasredhat/blob/master/images/sat1512.png?raw=true"></p>

En la sección de Paquetes le damos a Acciones




cd website/
vi index.html

git add index.html
git commit -m "actualizacion 01" index.html
git push -u origin master
oc start-build website
oc logs -f buildconfig/website