<h1>OpenShift Dia 3</h1>

<p>
<strong>Meta:</strong>
<br>Conocer el flujo de trabajo de openshift
</p>
<p>
<strong>Objetivos:</strong>
<br>- Automatizar el despliegue de aplicaciones con openshift
</p>
<p>
<strong>Secciones:</strong>
<br>- Gesti√≥n aplicaciones
</p>
<p>
<strong>Laboratorios:</strong>
<br><strong>- Desplegar un servicio web con contenido externo</strong>


</p>

<strong>Requisitos:</strong>
<br><strong>- Satellite</strong>
<br><strong>- RHEL client</strong>

<h3><br><strong>## Despliegue de webserver con contenido desde un git</strong></h3>
Antes de desplegar el servidor web desde el cliente de openshift, ingresamos al git privado de la clase disponible en http://192.168.10.190:3000 y creamos una cuenta de alumno0X
<p align="left"><img src="https://github.com/workshopopennova/workshopclaro/raw/main/images/os001.png?raw=true?raw=true"></p>

Ingresamos los datos del usuario0X
<p align="left"><img src="https://github.com/workshopopennova/workshopclaro/raw/main/images/os002.png?raw=true?raw=true"></p>

Iniciamos sesion con el usuario creado
<p align="left"><img src="https://github.com/workshopopennova/workshopclaro/raw/main/images/os003.png?raw=true?raw=true"></p>

Creamos un nuevo repositorio
<p align="left"><img src="https://github.com/workshopopennova/workshopclaro/raw/main/images/os004.png?raw=true?raw=true"></p>

Nombremos este repositorio website y que no sea privado
<p align="left"><img src="https://github.com/workshopopennova/workshopclaro/raw/main/images/os005.png?raw=true?raw=true"></p>

Con el repositorio creado pero sin archivos ingresamos a nuestro estacion linux e iniciamos sesion con el usuario alumno0X
<br>`# oc login -u alumno08`

Cambiamos al proyecto website0X
<br>`# oc project website08`

Descargamos el contenido del repositorio website desde el ftp del salon
<br>`# wget ftp://192.168.10.190/openshift/website.tar.gz`

Descomprimimos e ingresamos al contenido
<br>`# tar -xzvf website.tar.gz`
<br>`# cd website/`

Procedemos a poblar el repositorio del gIt con nuestros archivos descargados
<br>`# touch README.md`
<br>`# git init`
<br>`# git add *`
<br>`# git commit -m "first commit"`
<br>`# git remote add origin http://192.168.10.190:3000/alumno08/website.git`
<br>`# git push -u origin master`

Regresamos a la pagina del git y validamos la creacion del contenido web
<p align="left"><img src="https://github.com/workshopopennova/workshopclaro/raw/main/images/os006.png?raw=true?raw=true"></p>

En el terminal logueado, descargamos desde el ftp del salon una imagen de podman de php
<br>`# cd`
<br>`# wget ftp://192.168.10.190/openshift/php-70-rhel7.tar`

Cargamos esta imagen en el podman local
<br>`# podman load -i php-70-rhel7.tar`

Verificamos la disponibilidad de la imagen
<br>`# podman image list`

Importamos esta imagen a nuestro proyecto website
<br>`# oc import-image registry.access.redhat.com/rhscl/php-70-rhel7 --confirm`
<br>`# oc get is`

Desplegamos esta imagen en un app llamado website y que su contruccion referencie a nuestro git con el contenido propio
<br>`# oc new-app php-70-rhel7~http://192.168.10.190:3000/alumno08/website.git --name=website`

Verificamos el despliegue de la aplicacion
<br>`# oc logs -f buildconfig/website`

Publicamos la aplicacion
<br>`# oc expose service/website`

Verificamos la ruta de publicacion para validarla por navegador web
<br>`# oc get routes`

Ingresamos a un navegador y verificamos
<p align="left"><img src="https://github.com/workshopopennova/workshopclaro/raw/main/images/os007.png?raw=true?raw=true"></p>

Como parte del ejercicio, vamos a actualizar el contenido web y mostrar el flujo de redespliegue de aplicaciones sin afectar el sistema en produccion, para ello primero ingresamos a la carpeta de website y actualizamos algun contenido
<br>`# cd website/`
<br>`# vi index.html`
Cambiamos alguna linea del index como Our Company como Alumno0X Company

Registramos el cambio en el git y lo sincronizamos
<br>`# git add index.html`
<br>`# git commit -m "actualizacion 01" index.html`
<br>`# git push -u origin master`

Como el despliegue sique apuntando al mismo git, solo debemos invocar un redespliegue
<br>`# oc start-build website`

Verificamos el proceso de actualizacion
<br>`#  oc logs -f buildconfig/website`

Ingresamos a un navegador y verificamos el cambio
<p align="left"><img src="https://github.com/workshopopennova/workshopclaro/raw/main/images/os007.png?raw=true?raw=true"></p>

<h3><br><strong>## Despliegue de middlewarecon contenido desde un git</strong></h3>
Vamos a reutilizar la cuenta de alumno0X del git del salon y creamos un nuevo repositorio
<p align="left"><img src="https://github.com/workshopopennova/workshopclaro/raw/main/images/os008.png?raw=true?raw=true"></p>

Creamos el repositorio no privado llamado jboss
<p align="left"><img src="https://github.com/workshopopennova/workshopclaro/raw/main/images/os009.png?raw=true?raw=true"></p>

Volvemos al cliente openshift y nos logueamos a la plataforma 
<br>`# oc login -u alumno08`

Cambiamos al proyecto jboss08
<br>`# oc project jboss08`

Descargamos el contenido del repositorio jboss desde el ftp del salon
<br>`# wget ftp://192.168.10.190/openshift/jboss.tar.gz`

Descomprimimos e ingresamos al contenido
<br>`# tar -xzvf jboss.tar.gz`
<br>`# cd jboss/`

Procedemos a poblar el repositorio del gIt con nuestros archivos descargados
<br>`# touch README.md`
<br>`# git init`
<br>`# git add *`
<br>`# git commit -m "first commit"`
<br>`# git remote add origin http://192.168.10.190:3000/alumno08/jboss.git`
<br>`# git push -u origin master`

Regresamos a la pagina del git y validamos la creacion del contenido web
<p align="left"><img src="https://github.com/workshopopennova/workshopclaro/raw/main/images/os010.png?raw=true?raw=true"></p>

<h3><a href="os">Volver</a></h3>
