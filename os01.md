<h1>Red Hat Openshift Container Platform - Contenedores</h1>
<p align="left"><img src="https://github.com/workshopopennova/tecnologiasredhat/blob/master/images/os/os100.png?raw=true"width="800" height="400"></p>
<p>
<strong>Meta:</strong>
<br>- Entendimiento de la tecnología de contenedores.
</p>
<p>
<strong>Objetivos:</strong>
<br>- Conceptos de contenedores y podman (Teórico)
</p>
<p>
<strong>Secciones:</strong>
<br>- Introducción a tecnología de contenedores. (Teórico)
<br>- Introducción a la gestión de contenedores con podman. (Teórico)
<br>- Administrando contenedores con podman. (Demostración) 
</p>
<p>
<strong>Laboratorios:</strong>
</p>

# Introducción a Contenedores. (Teórico)
<p align="left"><img src="https://github.com/workshopopennova/tecnologiasredhat/blob/master/images/os/os101.jpg?raw=true"width="800" height="400"></p>

### **¿Qué son los contenedores?**
<br> Un contenedor​ es un recipiente de carga para el transporte marítimo o fluvial, transporte terrestre y transporte multimodal

Los contenedores en TI, son tecnologías que le permiten empaquetar y aislar las aplicaciones junto con todo el entorno de tiempo de ejecución, es decir, con todos los archivos que requieren para ejecutarse

<p align="left"><img src="https://github.com/workshopopennova/tecnologiasredhat/blob/master/images/os/os104.PNG?raw=true"width="800" height="400"></p>

<p align="left"><img src="https://github.com/workshopopennova/tecnologiasredhat/blob/master/images/os/os109.PNG?raw=true"width="800" height="400"></p>

<p align="left"><img src="https://github.com/workshopopennova/tecnologiasredhat/blob/master/images/os/os110.PNG?raw=true"width="800" height="400"></p>

<p align="left"><img src="https://github.com/workshopopennova/tecnologiasredhat/blob/master/images/os/os111.PNG?raw=true"width="800" height="400"></p>

<p align="left"><img src="https://github.com/workshopopennova/tecnologiasredhat/blob/master/images/os/os114.PNG?raw=true"width="800" height="400"></p>




## Maquinas Virtuales vs Contenedores

<p align="left"><img src="https://github.com/workshopopennova/tecnologiasredhat/blob/master/images/os/os105.PNG?raw=true"width="800" height="400"></p>

<p align="left"><img src="https://github.com/workshopopennova/tecnologiasredhat/blob/master/images/os/os106.PNG?raw=true"width="800" height="400"></p>

<p align="left"><img src="https://github.com/workshopopennova/tecnologiasredhat/blob/master/images/os/os107.PNG?raw=true"width="800" height="400"></p>

<p align="left"><img src="https://github.com/workshopopennova/tecnologiasredhat/blob/master/images/os/os108.PNG?raw=true"width="800" height="400"></p>



Beneficios:
- Ahorro de costos operativos.
- Mitigar el error humano.
- Simplificar tareas repetitivas.
- Facilitar despliegues e integraciones.
- Reducción del tiempo de ejecución de tareas.
---
<p align="left"><img src="https://github.com/workshopopennova/tecnologiasredhat/blob/master/images/os/os115.png?raw=true"width="400" height="200"></p>

### **Introducción a la gestión de contenedores con podman**

<br>Podman es una herramienta de código abierto, nativa de Linux sin demonios, diseñada para facilitar la búsqueda, ejecución, compilación, uso compartido e implementación de aplicaciones utilizando contenedores e imágenes de contenedor de la Iniciativa de Contenedores Abiertos (OCI). 

Podman proporciona una interfaz de línea de comandos (CLI) familiar para cualquiera que haya utilizado Docker Container Engine. La mayoría de los usuarios pueden simplemente alias Docker a Podman (alias docker = podman) sin ningún problema. 

Al igual que otros motores de contenedores comunes (Docker, CRI-O, containerd), Podman se basa en un Container Runtime compatible con OCI (runc, crun, runv, etc.) para interactuar con el sistema operativo y crear los contenedores en ejecución. Esto hace que los contenedores en ejecución creados por Podman sean casi indistinguibles de los creados por cualquier otro motor de contenedores común.


<p align="left"><img src="https://github.com/workshopopennova/tecnologiasredhat/blob/master/images/os/os112.PNG?raw=true"width="800" height="400"></p>

---
# Administración de contenedores con Podman. (Demostración)
<p align="left"><img src="https://github.com/workshopopennova/tecnologiasredhat/blob/master/ans/ans106.png?raw=true"width="800" height="400"></p>
<p>

## **Gestión de contenedores con Podman**

### Pull
```
[root@podman ~]# podman pull registry.access.redhat.com/ubi8:latest
Trying to pull registry.access.redhat.com/ubi8:latest...
Getting image source signatures
Copying blob 63f9f4c31162 done
Copying blob ce3c6836540f done
Copying config cc06568478 done
Writing manifest to image destination
Storing signatures
cc0656847854310306093b3dc1a7d9e7fc06399da46853e0c921cd5ec1906bfd
```

### RUN
```
[root@podman ~]# podman run --name rhel8 -it -d registry.access.redhat.com/ubi8:latest /bin/bash
527e97212a0fb8fbcdb4b0b622ea1b84f17949e88be3682c143a02e501db4f9a
```

### PS
```
[root@podman ~]# podman ps
CONTAINER ID  IMAGE                                   COMMAND    CREATED         STATUS             PORTS  NAMES
527e97212a0f  registry.access.redhat.com/ubi8:latest  /bin/bash  20 seconds ago  Up 20 seconds ago         rhel8
```

### STOP
```
[root@podman ~]# podman stop rhel8
527e97212a0fb8fbcdb4b0b622ea1b84f17949e88be3682c143a02e501db4f9a
```

### START
```
[root@podman ~]# podman start rhel8
rhel8
```

### RESTART
```
[root@podman ~]# podman restart rhel8
527e97212a0fb8fbcdb4b0b622ea1b84f17949e88be3682c143a02e501db4f9a
```

### PS -A
```
[root@podman ~]# podman stop rhel8
527e97212a0fb8fbcdb4b0b622ea1b84f17949e88be3682c143a02e501db4f9a

[root@podman ~]# podman ps
CONTAINER ID  IMAGE  COMMAND  CREATED  STATUS  PORTS  NAMES

[root@podman ~]# podman ps -a
CONTAINER ID  IMAGE                                   COMMAND               CREATED             STATUS                    PORTS                                                                      NAMES
527e97212a0f  registry.access.redhat.com/ubi8:latest  /bin/bash             About a minute ago  Exited (0) 4 seconds ago                       

[root@podman ~]# podman start rhel8
rhel8                                                      rhel8

[root@podman ~]# podman ps
CONTAINER ID  IMAGE                                   COMMAND    CREATED        STATUS             PORTS  NAMES
527e97212a0f  registry.access.redhat.com/ubi8:latest  /bin/bash  2 minutes ago  Up 10 seconds ago         rhel8
```

EXEC

```
[root@podman ~]# podman exec -it rhel8 /bin/bash

[root@527e97212a0f /]# exit
exit

[root@podman ~]# podman exec -it -l /bin/bash

[root@527e97212a0f /]# exit
exit
```

### Para depurar utilizar STOP y RM
```
[root@podman ~]# podman stop rhel8
527e97212a0fb8fbcdb4b0b622ea1b84f17949e88be3682c143a02e501db4f9a

[root@podman ~]# podman rm rhel8
527e97212a0fb8fbcdb4b0b622ea1b84f17949e88be3682c143a02e501db4f9a
```

###RMI
```
[root@podman ~]# podman rmi registry.access.redhat.com/ubi8:latest
Untagged: registry.access.redhat.com/ubi8:latest
Deleted: cc0656847854310306093b3dc1a7d9e7fc06399da46853e0c921cd5ec1906bfd
```

### Si la imagen no se ha puleado inicialmente y se ejecutar un run este proceso la descarga
```
[root@podman ~]# podman run --name rhel8 -it -d registry.access.redhat.com/ubi8:latest
Trying to pull registry.access.redhat.com/ubi8:latest...
Getting image source signatures
Copying blob 63f9f4c31162 done
Copying blob ce3c6836540f done
Copying config cc06568478 done
Writing manifest to image destination
Storing signatures
593fdfffa935ff7b014cec1e724b104900b5942f0fffb4559ba59a9817955bd5

[root@podman ~]# podman images
REPOSITORY                        TAG      IMAGE ID       CREATED         SIZE
registry.access.redhat.com/ubi8   latest   cc0656847854   2 weeks ago     235 MB
```

### Crear un objeto de tipo usuario, asignarle una contraseña y probar la efimeralidad

```
[root@podman ~]# podman exec -it -l /bin/bash

[root@527e97212a0f /]# useradd user9
[root@527e97212a0f /]# passwd user9
Changing password for user user9.
New password:
BAD PASSWORD: The password is shorter than 8 characters
Retype new password:
passwd: all authentication tokens updated successfully.

[root@527e97212a0f /]# id user9
uid=1000(user9) gid=1000(user9) groups=1000(user9)

[root@527e97212a0f /]# cat /etc/passwd | grep user9
user9:x:1000:1000::/home/user9:/bin/bash

[root@527e97212a0f /]# cat /etc/shadow | grep user9
user9:$6$ZpD1cIjGEdfLDe5j$7W4PEpIP8ljIG7pbrhakMys4e8iDL1Hj7N/fQvyaLI1W1.cNJcwPKKDql1sgSuN4QqEbKaW4G.CBCoYwXuRAd0:18949:0:99999:7:::

[root@527e97212a0f /]# exit
exit

[root@podman ~]# podman stop rhel8 ; podman rm rhel8
593fdfffa935ff7b014cec1e724b104900b5942f0fffb4559ba59a9817955bd5
593fdfffa935ff7b014cec1e724b104900b5942f0fffb4559ba59a9817955bd5

[root@podman ~]# podman run --name rhel8 -it -d registry.access.redhat.com/ubi8:latest
50861d1d07cb6faa7ec68a6f274469680dfc50d7677ca3eb73992ae4580fdbd4

[root@podman ~]# podman exec -l -it /bin/bash

[root@50861d1d07cb /]# id user9
id: ‘user9’: no such user

[root@50861d1d07cb /]# exit
exit

[root@podman ~]# podman stop rhel8 ; podman rm rhel8
50861d1d07cb6faa7ec68a6f274469680dfc50d7677ca3eb73992ae4580fdbd4
50861d1d07cb6faa7ec68a6f274469680dfc50d7677ca3eb73992ae4580fdbd4
```

### COMMIT
```
[root@podman ~]# podman run --name rhel8 -it -d registry.access.redhat.com/ubi8:latest
ca0c15e06900db412c703ec0af252c551b4bb590df631c3b7d3e7434cd15e631

[root@podman ~]# podman exec -l -it /bin/bash

[root@ca0c15e06900 /]# useradd user9

[root@ca0c15e06900 /]# echo "redhat" | passwd --stdin user9
Changing password for user user9.
passwd: all authentication tokens updated successfully.

[root@ca0c15e06900 /]# su - user9

[user9@ca0c15e06900 ~]$ id
uid=1000(user9) gid=1000(user9) groups=1000(user9)

[user9@ca0c15e06900 ~]$ exit
logout

[root@ca0c15e06900 /]# exit
exit

[root@podman ~]# podman commit -q -a "Jaime Zamudio" rhel8 custom-rhel8

[root@podman ~]# podman images
REPOSITORY                        TAG      IMAGE ID       CREATED              SIZE
localhost/custom-rhel8            latest   0759772b92eb   About a minute ago   235 MB
registry.access.redhat.com/ubi8   latest   cc0656847854   2 weeks ago          235 MB

[root@podman ~]# podman stop rhel8 ; podman rm rhel8
ca0c15e06900db412c703ec0af252c551b4bb590df631c3b7d3e7434cd15e631
ca0c15e06900db412c703ec0af252c551b4bb590df631c3b7d3e7434cd15e631

[root@podman ~]# podman run --name rhel8 -it -d localhost/custom-rhel8
ca3d137601cf6408394bbdc8c2f6350e615b1bb7c2a92920acdaafcc1d21c094

[root@podman ~]# podman exec -it -l /bin/bash

[root@ca3d137601cf /]# id user9
uid=1000(user9) gid=1000(user9) groups=1000(user9)

[root@ca3d137601cf /]# grep ^user9 /etc/passwd
user9:x:1000:1000::/home/user9:/bin/bash

[root@ca3d137601cf /]# grep ^user9 /etc/shadow
user9:$6$V2Ht3.lE126nwzZx$DFPS/LGrxakLGye56RyhBrH05GTiCLItmfv3ZOLtgj1sVhe9imf/pQe.pHyMsPqUDZ4KQPS24t4Eazp8/Wq0s/:18949:0:99999:7:::
```

### TAG
```
[root@podman ~]# podman tag localhost/custom-rhel8:latest localhost/custom-rhel8:8.5

[root@podman ~]# podman tag localhost/custom-rhel8:latest localhost/custom-rhel8:5

[root@podman ~]# podman images
REPOSITORY                        TAG      IMAGE ID       CREATED              SIZE
localhost/custom-rhel8            5        be3485bdf603   About a minute ago   235 MB
localhost/custom-rhel8            latest   be3485bdf603   About a minute ago   235 MB
localhost/custom-rhel8            8.5      be3485bdf603   About a minute ago   235 MB
registry.access.redhat.com/ubi8   latest   cc0656847854   2 weeks ago          235 MB

[root@podman ~]# podman rmi -f localhost/custom-rhel8:5
Untagged: localhost/custom-rhel8:5

[root@podman ~]# podman images
REPOSITORY                        TAG      IMAGE ID       CREATED         SIZE
localhost/custom-rhel8            latest   be3485bdf603   3 minutes ago   235 MB
localhost/custom-rhel8            8.5      be3485bdf603   3 minutes ago   235 MB
registry.access.redhat.com/ubi8   latest   cc0656847854   2 weeks ago     235 MB

[root@podman ~]# podman run --name rhel85 -it -d localhost/custom-rhel8:8.5
0f0e0c4760036871671eaeb2dfef03eef64a2d787d208df2829b4d32cf8be375

[root@podman ~]# podman exec -it rhel85 /bin/bash

[root@0f0e0c476003 /]# id user9
uid=1000(user9) gid=1000(user9) groups=1000(user9)

[root@0f0e0c476003 /]# exit
exit

[root@podman ~]# podman stop rhel8 rhel85
0f0e0c4760036871671eaeb2dfef03eef64a2d787d208df2829b4d32cf8be375
ca3d137601cf6408394bbdc8c2f6350e615b1bb7c2a92920acdaafcc1d21c094

[root@podman ~]# podman rm rhel8 rhel85
ca3d137601cf6408394bbdc8c2f6350e615b1bb7c2a92920acdaafcc1d21c094
0f0e0c4760036871671eaeb2dfef03eef64a2d787d208df2829b4d32cf8be375
```

### SAVE
```
[root@podman ~]# podman save -q -o ~/custom-rhel8-latest.tar localhost/custom-rhel8:latest
Getting image source signatures
Copying blob 0d3f22d60daf done
Copying blob 0488bd866f64 done
Copying blob 431250c3978c done
Copying config be3485bdf6 done
Writing manifest to image destination
Storing signatures

[root@podman ~]# podman save -q -o ~/custom-rhel8-latest-85.tar localhost/custom-rhel8:8.5
Getting image source signatures
Copying blob 0d3f22d60daf done
Copying blob 0488bd866f64 done
Copying blob 431250c3978c done
Copying config be3485bdf6 done
Writing manifest to image destination
Storing signatures

[root@podman ~]# podman rmi localhost/custom-rhel8:latest
Untagged: localhost/custom-rhel8:latest

[root@podman ~]# podman rmi localhost/custom-rhel8:8.5
Untagged: localhost/custom-rhel8:8.5
Deleted: be3485bdf6039f8667428656b9ba2923c6e2811ad12b4039907d832c5bd0c46f
```

### LOAD
```
[root@podman ~]# podman load -i ~/custom-rhel8-latest.tar
Getting image source signatures
Copying blob 431250c3978c done
Copying blob 0d3f22d60daf skipped: already exists
Copying blob 0488bd866f64 skipped: already exists
Copying config be3485bdf6 done
Writing manifest to image destination
Storing signatures
Loaded image(s): localhost/custom-rhel8:latest

[root@podman ~]# podman load -i ~/custom-rhel8-latest-85.tar
Getting image source signatures
Copying blob 431250c3978c skipped: already exists
Copying blob 0d3f22d60daf [--------------------------------------] 0.0b / 0.0b
Copying blob 0488bd866f64 [--------------------------------------] 0.0b / 0.0b
Copying config be3485bdf6 done
Writing manifest to image destination
Storing signatures
Loaded image(s): localhost/custom-rhel8:8.5
```

### EXPORT
```
[root@podman ~]# podman export -o ~/custom-rhel8-export.tar 69c8bad2b79a
```

### IMPORT
```
[root@podman ~]# podman import ~/custom-rhel8-export.tar localhost/custom-rhel8
```

### INSPECT
```
[root@podman ~]# podman inspect rhel8
```

### HISTORY
```
[root@podman ~]# podman history rhel8
ID             CREATED         CREATED BY                                      SIZE      COMMENT
360af5b8406b   9 minutes ago   /bin/sh -c #(nop) ADD file:d540eab910cfd18...   221.9MB   imported from tarball
```

### STAT
```
[root@podman ~]# podman stats rhel8

ID             NAME    CPU %   MEM USAGE / LIMIT   MEM %   NET IO              BLOCK IO            PIDS
6bc4d894b63f   rhel8   --      2.92MB / 16.62GB    0.02%   1.048kB / 4.252kB   8.192kB / 4.096kB   1
```

### TOP
```
[root@podman ~]# podman top rhel8
USER   PID   PPID   %CPU    ELAPSED          TTY     TIME   COMMAND
root   1     0      0.000   13m2.41896166s   pts/0   0s     /bin/bash
```

### LOGS
```
[root@podman ~]# podman logs rhel8
```

### EVENTS
```
[root@podman ~]# podman events --since 30m
```

### PAUSE
```
[root@podman ~]# podman pause rhel8
6bc4d894b63f925f2b2105bf98bf34698b4042572453825df448a70a38d46dd1

[root@podman ~]# podman ps -a
CONTAINER ID  IMAGE                              COMMAND               CREATED         STATUS                   PORTS                                                                      NAMES
6bc4d894b63f  localhost/custom-rhel8:latest      /bin/bash             15 minutes ago  Paused      
```

### UNPAUSE
```
[root@podman ~]# podman unpause rhel8
6bc4d894b63f925f2b2105bf98bf34698b4042572453825df448a70a38d46dd1
```

### INFO
```
[root@podman ~]# podman info
```

### VERSION
```
[root@podman ~]# podman version
```


1. Listar repositorios disponibles y validar que contamos con ansible-2.9-for-rhel-8-x86_64-rpms



# Laboratorio: Setup Inicial Ansible

NOTA: 
- Las tareas a ejecutarse en el nodo de control serán en la estación server0X.opennova.pe, donde X es el numero de usuario del 1 al 6 respectivamente. 
- Las tareas a ejecutarse en los nodos administrados serán en las estaciones: nodeX1.opennova.pe, nodeX2.opennova.pe, nodeX3.opennova.pe, nodeX4.opennova.pe, donde X es el numero de usuario del 1 al 6 respectivamente. 
- Si al probar la conectividad via el modulo ping de ansible hacia los nodos administrador le sale el siguiente mensaje:
```
[ansible@server09 ansible]$ ansible -m ping prod
SSH password:
BECOME password[defaults to SSH password]:
node91.opennova.pe | FAILED! => {
    "msg": "Using a SSH password instead of a key is not possible because Host Key checking is enabled and sshpass does not support this.  Please add this host's fingerprint to your known_hosts file to manage this host."
}
```

Debe establecer la conexión ssh inicial desde el nodo de control hacia los nodos administrador como indica el **punto 5**. de la seccion **Configurar espacio de trabajo y recursos en el nodo de control**

**Requerimientos:**
1. Instalar y/o Actualizar Python en el nodo de control.
2. Instalar ansible en el nodo de control asignado.
3. Instalar y/o Actualizar Python en los nodos administrados.
4. En el nodo de control realizar lo siguiente:
- Crear el usuario ansible.
- Asignar la contraseña redhat.
- Crear un directorio de trabajo de nombre ansible.
- Configurar el editor vim para que pueda interpretar correctamente ansible. (Sino tiene vim instalado puede instalarlo)
- En el directorio de trabajo ansible descargar de ftp://classroom.opennova.pe los archivos: inventory-template, ansible.cfg.
5. Al inventario agregarle los siguientes grupos:
- Agregar el grupo webservers el cual debe contener los nodos: nodeX1.opennova.pe  y nodeX2.opennova.pe. (Revisar la nota inicial).
- Agregar el grupo deploy en cual debe contener los nodos: nodeX1.opennova.pe, nodeX2.opennova.pe, nodeX3.opennova.pe, nodeX4.opennova.pe.(Revisar la nota inicial).
- Agregar el grupo anidado infra el cual debe contener los grupos: webservers y deploy.
- Modificar el inventario de tal manera que todos los objetos ya pre configurados correspondan a su ambiente de laboratorio. Cambiar nodeX1.opennova.pe, nodeX2.opennova.pe, nodeX3.opennova.pe, nodeX4.opennova.pe por sus respectivos recursos asignados. (Revisar la nota inicial).
- Mover el recurso desagrupado nodeX4.opennova.pe dentro del grupo qa. (Revisar la nota inicial).
- Actualizar las direcciones ip del nodo4 y del nodo de control de su entorno, con los datos proporcionados en el taller. 
6. Listar los host que pertenecen a los grupos: prod, dev, qa, webservers, deploy, servers, infra, all y ungrouped y verificar que estan de acorde al inventario.
7. Para el nodoX1.opennova.pe realizar el procedimiento de **Configurar nodos administrados para trabajar con usuario ansible vía llaves ssh(Procedimiento manual clientes)**.
8. Para los nodos del grupo deploy realizar el procedimiento de **Configurar nodos administrados para trabajar con usuario ansible vía llaves ssh(Procedimiento vía nodo de control)**. 
9. Al final de este punto usted deberá tener su ambiente de ansible configurado de tal modo que el usuario de conexión hacia todos los nodos sea ansible sin solicitud de contraseña y el usuario de escalamiento de privilegios sea root sin solicitud de contaseña.
Al ejecutar estos comando en sus nodos de control correspondientes, todos los nodos administrados deberían responder sin solicitar contraseña.
```
[ansible@server09 ansible]$ ansible deploy -m ping 
```

```
[root@server09 ~]# ansible deploy -m shell -a "df -h"
```








